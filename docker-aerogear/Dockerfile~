#
#   To have an aerogear server
#

FROM dyn_jboss
MAINTAINER kevin.moreau@dynamease.com

RUN wget https://github.com/aerogear/aerogear-unifiedpush-server/releases/download/1.0.2/aerogear-unifiedpush-server-1.0.2-dist.tar.gz

ENV AEROGEAR_FILES /usr/local/share/aerogear
ENV JBOSS_HOME /usr/local/share/jboss

RUN mkdir $AEROGEAR_FILES

RUN mv aerogear-unifiedpush-server-1.0.2-dist.tar.gz /usr/local/share/aerogear

RUN tar -xvf $AEROGEAR_FILES/aerogear-unifiedpush-server-1.0.2-dist.tar.gz -C $AEROGEAR_FILES

RUN mv $AEROGEAR_FILES/aerogear-unifiedpush-server-1.0.2 $AEROGEAR_FILES/aerogear-server

ENV DEPLOYMENTS /usr/local/share/jboss/standalone/deployments/
ENV AEROGEAR_SERVER $AEROGEAR_FILES/aerogear-server

COPY script/initAerogear.sh $AEROGEAR_FILES/initAerogear.sh
COPY script/execAerogear.sh $AEROGEAR_FILES/execAerogear.sh

RUN chmod +x $AEROGEAR_FILES/initAerogear.sh
RUN chmod +x $AEROGEAR_FILES/execAerogear.sh

RUN $AEROGEAR_FILES/initAerogear.sh

RUN rm -rf /usr/local/share/jboss/standalone/configuration/standalone_xml_history/current

#ENTRYPOINT $AEROGEAR_FILES/execAerogear.sh
